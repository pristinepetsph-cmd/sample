<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MyTCG-Style • Pack Open • Collection • Pokedex (Prototype)</title>
<style>
  :root{--bg:#071022;--accent:#3aa1ff;--card-w:140px;--card-h:200px}
  *{box-sizing:border-box;font-family:Inter,Segoe UI,Arial,sans-serif}
  body{margin:0;background:linear-gradient(180deg,#031025,#071a2d);color:#e6f0f6;min-height:100vh;display:flex;flex-direction:column;align-items:center}
  header{width:100%;max-width:1200px;display:flex;align-items:center;justify-content:space-between;padding:18px 12px}
  h1{margin:0;font-size:18px}
  .tabs{display:flex;gap:8px}
  .tab{background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:8px;cursor:pointer}
  .tab.active{background:linear-gradient(90deg,var(--accent),#8b5cf6);color:white}
  main{width:100%;max-width:1200px;display:flex;gap:18px;padding:12px 18px 36px}
  .left{flex:1;display:flex;flex-direction:column;gap:12px;align-items:center}
  .scene{position:relative;width:100%;max-width:820px;height:580px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);box-shadow:0 10px 30px rgba(0,0,0,0.6);overflow:hidden}
  .pack{width:300px;height:420px;border-radius:18px;background:linear-gradient(180deg,#2b3b50,#1b2532);display:flex;align-items:center;justify-content:center;color:white;font-weight:800;cursor:pointer;transition:transform .6s,opacity .6s;z-index:30}
  .pack.opening{transform:scale(1.2) rotateX(-68deg);opacity:0}
  .cards-grid{position:absolute;inset:36px;display:grid;grid-template-columns:repeat(5,1fr);gap:18px;align-content:center;justify-items:center;opacity:0;transition:opacity .6s}
  .cards-grid.show{opacity:1}
  .card{width:var(--card-w);height:var(--card-h);perspective:1000px;opacity:0;transform:translateY(20px);transition:opacity .35s, transform .35s}
  .card.visible{opacity:1;transform:translateY(0)}
  .card-inner{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .7s}
  .card.revealed .card-inner{transform:rotateY(180deg)}
  .card-face{position:absolute;inset:0;border-radius:10px;backface-visibility:hidden;overflow:hidden;display:flex;align-items:center;justify-content:center}
  .card-back{background:linear-gradient(135deg,#0f1724,#1f2a38);color:#cbd5e1;font-weight:700}
  .card-front{background:#fff;color:#000;padding:6px;transform:rotateY(180deg);display:flex;flex-direction:column;align-items:center;justify-content:flex-start}
  .card-front img{width:100%;height:auto;border-radius:6px;display:block;margin-top:6px;flex:1;object-fit:cover}
  .holo::before{content:"";position:absolute;inset:0;border-radius:10px;background:linear-gradient(120deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.22) 40%, rgba(255,255,255,0.04) 80%);mix-blend-mode:screen;animation:holoMove 3s linear infinite}
  @keyframes holoMove{from{transform:translateX(-150%) skewX(-10deg)}to{transform:translateX(150%) skewX(-10deg)}}
  .rare::after{content:"";position:absolute;inset:0;border-radius:10px;box-shadow:0 0 28px 8px rgba(255,215,80,0.2) inset}
  .controls{display:flex;gap:8px;align-items:center;margin-top:8px}
  .btn{background:linear-gradient(90deg,var(--accent),#8b5cf6);padding:10px 14px;border-radius:10px;cursor:pointer;border:none;color:white;font-weight:700}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
  .right{width:360px;display:flex;flex-direction:column;gap:12px}
  .panel{background:rgba(255,255,255,0.025);padding:12px;border-radius:10px;max-height:520px;overflow:auto}
  .search{display:flex;gap:8px;margin-bottom:8px}
  input[type="text"]{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:white}
  .card-row{display:flex;gap:10px;align-items:center;padding:8px;border-bottom:1px solid rgba(255,255,255,0.02)}
  .card-row img{width:56px;height:80px;object-fit:cover;border-radius:6px}
  footer{margin-top:18px;color:#8ea6b8;font-size:13px;padding-bottom:18px}
  @media (max-width:980px){main{flex-direction:column}.right{width:100%}}
</style>
</head>
<body>
<header>
  <h1>MyTCG-Style Prototype</h1>
  <div class="tabs">
    <div class="tab active" data-tab="open">Open Packs</div>
    <div class="tab" data-tab="collection">My Collection</div>
    <div class="tab" data-tab="pokedex">Pokedex</div>
  </div>
</header>

<main>
  <section class="left">
    <div class="scene" role="region" aria-label="Pack opening area">
      <div id="pack" class="pack" title="Click to open">Click to Open</div>
      <div id="cardsGrid" class="cards-grid" aria-hidden="true"></div>
    </div>

    <div class="controls">
      <button id="buyBtn" class="btn">Buy Pack (simulate)</button>
      <button id="resetBtn" class="btn ghost">Reset Collection</button>
      <div style="flex:1"></div>
      <small id="status">Ready</small>
    </div>
  </section>

  <aside class="right">
    <div class="panel" id="collectionPanel">
      <h3>My Collection</h3>
      <div id="collectionList"><small>No cards yet — open a pack.</small></div>
    </div>

    <div class="panel" id="pokedexPanel">
      <h3>Pokedex / Search</h3>
      <div class="search">
        <input id="searchInput" placeholder="Search card name (e.g. Pikachu)" />
        <button id="searchBtn" class="btn">Search</button>
      </div>
      <div id="searchResults"></div>
    </div>
  </aside>
</main>

<footer>
  Prototype: uses Pokémon TCG API (optional API key). Replace pack art & images with your own licensed assets.
</footer>

<script>
/* Simple, commented prototype: no server code. Paste & run. */

const API_BASE = 'https://api.pokemontcg.io/v2';
const API_KEY = ''; // OPTIONAL: your API key
const HEADERS = API_KEY ? { 'X-Api-Key': API_KEY } : {};

const packEl = document.getElementById('pack');
const cardsGrid = document.getElementById('cardsGrid');
const statusEl = document.getElementById('status');
const buyBtn = document.getElementById('buyBtn');
const resetBtn = document.getElementById('resetBtn');

const searchInput = document.getElementById('searchInput');
const searchBtn = document.getElementById('searchBtn');
const searchResults = document.getElementById('searchResults');

let localCollection = JSON.parse(localStorage.getItem('my_collection_v1')||'[]');

function setStatus(s){ statusEl.textContent = s; }
function saveCollection(){ localStorage.setItem('my_collection_v1', JSON.stringify(localCollection)); renderCollection(); }

function renderCollection(){
  const out = document.getElementById('collectionList');
  if(!localCollection.length){ out.innerHTML = '<small>No cards yet — open a pack.</small>'; return; }
  out.innerHTML = '';
  localCollection.forEach(card=>{
    const row = document.createElement('div');
    row.className = 'card-row';
    row.innerHTML = `
      <img src="${card.images?.small || card.image || ''}" alt="${escapeHtml(card.name)}" />
      <div style="flex:1">
        <div style="font-weight:700">${escapeHtml(card.name)}</div>
        <small>${escapeHtml(card.set?.name||'')} • ${escapeHtml(card.rarity||'')}</small>
      </div>
      <button class="btn ghost" data-id="${card.id}">Remove</button>
    `;
    row.querySelector('button').addEventListener('click', ()=>{
      localCollection = localCollection.filter(c=>c.id !== card.id);
      saveCollection();
    });
    out.appendChild(row);
  });
}

function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

async function fetchCardPool(pageSize=200){
  setStatus('Loading card pool…');
  try{
    const res = await fetch(`${API_BASE}/cards?pageSize=${pageSize}`, { headers: HEADERS });
    const j = await res.json();
    setStatus('Card pool loaded');
    return j.data || [];
  }catch(e){
    console.error(e);
    setStatus('Failed to fetch cards — check network');
    return [];
  }
}

function sample(array, n=10){
  const copy = array.slice();
  const out = [];
  for(let i=0;i<n && copy.length;i++){
    out.push(copy.splice(Math.floor(Math.random()*copy.length),1)[0]);
  }
  return out;
}

function createCardElement(card){
  const el = document.createElement('div');
  el.className = 'card';
  el.dataset.id = card.id;
  el.innerHTML = `<div class="card-inner">
    <div class="card-face card-back">?</div>
    <div class="card-face card-front ${(card.rarity||'').toLowerCase().includes('holo')?'holo':''} ${(card.rarity||'').toLowerCase().includes('rare')?'rare':''}">
      <div style="font-weight:700;font-size:13px">${escapeHtml(card.name)}</div>
      <div style="font-size:11px;color:#556">${escapeHtml(card.set?.name||'')}</div>
      <img src="${card.images?.small||card.image||''}" alt="${escapeHtml(card.name)}" />
      <div style="margin-top:6px"><button class="btn" data-action="add">Add to Collection</button></div>
    </div>
  </div>`;
  return el;
}

function clearGrid(){ cardsGrid.innerHTML=''; cardsGrid.classList.remove('show'); cardsGrid.setAttribute('aria-hidden','true'); }

async function openPackSequence(){
  // pack animation
  packEl.classList.add('opening');
  setStatus('Opening pack...');
  await new Promise(r=>setTimeout(r,650));
  packEl.style.display='none';

  // fetch pool and show
  const pool = await fetchCardPool(250);
  if(!pool.length){ setStatus('No cards loaded'); return; }
  const picks = sample(pool, 10);
  clearGrid();
  picks.forEach(c => cardsGrid.appendChild(createCardElement(c)));
  cardsGrid.classList.add('show');
  cardsGrid.setAttribute('aria-hidden','false');

  // entry animation
  const cardEls = Array.from(cardsGrid.querySelectorAll('.card'));
  for(let i=0;i<cardEls.length;i++){
    const el = cardEls[i];
    setTimeout(()=> el.classList.add('visible'), i*100);
  }

  // reveal one-by-one and attach add handlers
  setStatus('Revealing cards...');
  for(let i=0;i<cardEls.length;i++){
    await new Promise(r=>setTimeout(r, 700));
    const el = cardEls[i];
    el.classList.add('revealed'); // flip
    const addBtn = el.querySelector('[data-action="add"]');
    // find original pick by matching data-id
    const id = el.dataset.id;
    addBtn.addEventListener('click', async (ev)=>{
      ev.stopPropagation();
      addBtn.disabled = true; addBtn.textContent='Adding...';
      try{
        const res = await fetch(`${API_BASE}/cards/${id}`, { headers: HEADERS });
        const data = await res.json();
        const cardObj = data.data;
        if(!localCollection.some(c=>c.id===cardObj.id)){ localCollection.push(cardObj); saveCollection(); }
        addBtn.textContent='Added';
      }catch(e){
        console.error(e);
        addBtn.disabled=false; addBtn.textContent='Add to Collection';
      }
    });
  }
  setStatus('Pack opened');
}

// UI wiring
packEl.addEventListener('click', ()=> openPackSequence());
buyBtn.addEventListener('click', ()=> {
  setStatus('Simulating purchase…'); setTimeout(()=> openPackSequence(), 300);
});
resetBtn.addEventListener('click', ()=> { if(confirm('Clear local collection?')){ localCollection=[]; saveCollection(); } });

// simple search
searchBtn.addEventListener('click', async ()=>{
  const q = searchInput.value.trim();
  if(!q) return;
  searchResults.innerHTML = 'Searching…';
  try{
    const res = await fetch(`${API_BASE}/cards?q=name:${encodeURIComponent(q)}&pageSize=20`, { headers: HEADERS });
    const j = await res.json();
    const list = j.data || [];
    if(!list.length){ searchResults.innerHTML='<small>No results</small>'; return; }
    searchResults.innerHTML='';
    list.forEach(card=>{
      const r = document.createElement('div'); r.className='card-row';
      r.innerHTML = `<img src="${card.images?.small||''}" alt="${escapeHtml(card.name)}" />
        <div style="flex:1"><div style="font-weight:700">${escapeHtml(card.name)}</div><small>${escapeHtml(card.set?.name||'')} • ${escapeHtml(card.rarity||'')}</small></div>
        <button class="btn" data-id="${card.id}">Add</button>`;
      r.querySelector('button').addEventListener('click', ()=>{ if(!localCollection.some(c=>c.id===card.id)){ localCollection.push(card); saveCollection(); } });
      searchResults.appendChild(r);
    });
  }catch(e){ console.error(e); searchResults.innerHTML='<small>Error</small>'; }
});

searchInput.addEventListener('keydown', e=>{ if(e.key==='Enter') searchBtn.click(); });

// initial
renderCollection();

// simple tab switch (keeps right column panels visible; you can expand to hide/show)
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click', ()=> {
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    // basic behaviour: if opening tab selected, ensure left visible; else left hidden to mimic site
    const tab = t.dataset.tab;
    if(tab==='open'){ document.querySelector('.left').style.display='flex'; } else { document.querySelector('.left').style.display='none'; }
  });
});

</script>
</body>
</html>
